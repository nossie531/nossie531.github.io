<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
	<head>
		<title>Rust メモ: error - 定数式でのジェネリクス定数による計算</title>
		<link rel="stylesheet" href="style/base.css"/>
		<script src="../../lib/doc.js"></script>
		<script src="lib/base.js"></script>
	</head>
	<body>
		<header>
			<h1><doc-title/></h1>
		</header>
<pre><samp class="console-rustc">
<mark class="error">error</mark><mark class="title">: generic parameters may not be used in const operations</mark>
</samp></pre>
		<p>
定数式でジェネリクス定数を使った計算が行われた。
		</p>
		<section>
			<h1>原因</h1>
			<p>
これは<time>2025 年現在</time>の Rust の制限である。
			</p> <p>
歴史を追うと、Rust 1.51 (2021-03-25) で機能 <code>min_const_generics</code> が導入されて以降、ジェネリクス定数についての機能は少しずつ拡充してきている。そして、現在はまだいくつかの重要な機能が足りていない。
			</p> <p>
不安定な機能 <a href="https://doc.rust-lang.org/beta/unstable-book/language-features/generic-const-exprs.html"><code>generic_const_exprs</code></a> ではこの問題を解決しようとしている。しかし、この機能はまだ開発途中のため、ナイトリー版でも試用に注意が必要となる。
			</p>
		</section> <section>
			<h1>サンプル</h1>
<pre><code class="language-rust">
fn main() {
    let mut dst = [0; 5];
    merge_to(&amp;mut dst, &amp;[1, 2], &amp;[3, 4, 5]);
    assert_eq!(dst, [1, 2, 3, 4, 5]);
}

fn merge_to&lt;const M: usize, const N: usize&gt;(
	dst: &amp;mut [i32; <mark class="error">M</mark> + <mark class="error">N</mark>],
    src1: &amp;[i32; M],
    src2: &amp;[i32; N],
) {
    dst[0..M].copy_from_slice(src1);
    dst[M..M + N].copy_from_slice(src2);
}
</code></pre>
<pre><samp class="console-rustc">
<mark class="error">error</mark><mark class="title">: generic parameters may not be used in const operations</mark>
<mark class="info"> --&gt;</mark> src\main.rs:8:21
<mark class="info">  |</mark>
<mark class="info">8 |</mark>     dst: &amp;mut [i32; M + N],
<mark class="info">  |</mark>                     <mark class="error">^ cannot perform const operation using `M`</mark>
<mark class="info">  |</mark>
<mark class="info">  =</mark> <mark class="title">help</mark>: const parameters may only be used as standalone arguments, i.e. `M`
<mark class="info"></mark>
<mark class="error">error</mark><mark class="title">: generic parameters may not be used in const operations</mark>
<mark class="info"> --&gt;</mark> src\main.rs:8:25
<mark class="info">  |</mark>
<mark class="info">8 |</mark>     dst: &amp;mut [i32; M + N],
<mark class="info">  |</mark>                         <mark class="error">^ cannot perform const operation using `N`</mark>
<mark class="info">  |</mark>
<mark class="info">  =</mark> <mark class="title">help</mark>: const parameters may only be used as standalone arguments, i.e. `N`
</samp></pre>
		</section>
	</body>
</html>
