<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
	<head>
		<title>Rust メモ: 孤児ルール</title>
		<link rel="stylesheet" href="style/base.css"/>
		<script src="../../lib/doc.js"></script>
		<script src="lib/base.js"></script>
	</head>
	<body>
		<header>
			<h1><doc-title/></h1>
		</header>
		<p>
孤児ルール (orphan rule) について。
		</p>
		<section>
			<h1>基礎知識</h1>
			<p>
『<a href="e0119.xhtml">E0119 - トレイト実装の衝突</a>』で紹介する通り、トレイト実装時に同じ型と同じトレイトの組合せですでに他に実装があると、それらが衝突してエラーになる。
			</p>
		</section> <section>
			<h1>ルールの必要性</h1>
			<p>
もし仮に、この衝突が完成済のクレートのトレイト実装どうしでもあるなら、新しいクレートの導入のたびに既存のクレートとの相性確認が必要になってしまう。そのため、孤児ルールではそうした衝突がないよう、予め各クレートが実装できる範囲を制限している。
			</p>
		</section> <section>
			<h1>仕様</h1>
			<doc-quote src="quote/reference/item/implementations.xhtml"/>
			<section>
				<h2 id="basicRule">解説 (基本ルール)</h2>
				<p>
トレイトと型の両方が同時に外部クレート由来であってはならない。<br/>
言い換えると、どちらか一方はローカル由来でなければならない。
				</p>
			</section> <section>
				<h2 id="additionalRule">解説 (追加ルール)</h2>
				<p>
外部クレート由来のトレイトでも、ローカル由来の型引数を含む場合、ローカル扱いできる。ただし、それよりも前の型引数または実装対象の型が型パラメタで表現されている場合、他のクレートがそこに自身のローカル型を指定する場合を優先したいので、その場合については例外となる。
				</p>
			</section> <section>
				<h2>実例</h2>
				<p>
以下は確実にコンパイルエラーになる。
				</p>
				<ul>
					<li>
<code>impl ForeginTrait for ForeginType</code>
					</li> <li>
<code>impl&lt;T&gt; ForeginTrait&lt;MyType&gt; for T</code>
					</li> <li>
<code>impl&lt;T&gt; ForeginTrait&lt;T, MyType&gt; for ForeginType</code>
					</li>
				</ul>
				<p>
以下は E0119 が発生しなければコンパイルできる。
				</p>
				<ul>
					<li>
<code>impl MyTrait for ForeginType</code>
					</li> <li>
<code>impl ForeginTrait for MyType</code>
					</li> <li>
<code>impl&lt;T&gt; ForeginTrait&lt;MyType&gt; for ForeginType</code>
					</li> <li>
<code>impl&lt;T&gt; ForeginTrait&lt;MyType, T&gt; for ForeginType</code>
					</li> <li>
<code>impl&lt;T&gt; ForeginTrait&lt;ForeginType2, MyType&gt; for ForeginType</code>
					</li> <li>
<code>impl&lt;T&gt; ForeginTrait&lt;Cover&lt;T&gt;, MyType&gt; for ForeginType</code>
					</li>
				</ul>
			</section>
		</section>
	</body>
</html>
